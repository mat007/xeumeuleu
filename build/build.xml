<?xml version="1.0"?>
<project name="xeumeuleu" default="all">

    <!--
    <property name="platform" value="cygwin"/>
    <property name="compiler" value="gcc"/>

    <import file="../../../projects/poney/src/poney/poney.xml"/>
    -->
    <import file="//install/masa/common/dev/common/poney/poney.xml"/>

    <!--
    ============================================================================
      libraries
    ============================================================================
    -->
    <target name="xeumeuleu" description="build library">
        <build-lib name="xeumeuleu"/>
    </target>

    <!--
    ============================================================================
      tests
    ============================================================================
    -->
    <target name="xeumeuleu_test" depends="xeumeuleu" description="build and run tests">
        <build-test name="xeumeuleu" libs="xeumeuleu,xerces-c_2"/>
    </target>

    <!--
    ============================================================================
      clean
    ============================================================================
    -->
    <target name="clean" description="clean intermediate build artifacts">
        <clean name="xeumeuleu"/>
        <clean name="xeumeuleu_test"/>
    </target>

    <!--
    ============================================================================
      export
    ============================================================================
    -->
    <target name="export" depends="build,test" description="export the distribution">
        <deploy>
            <include name="**/*.lib"/>
            <include name="**/xml.h"/>
            <include name="**/exception.h"/>
            <include name="**/xi*.h"/>
            <include name="**/xo*.h"/>
            <include name="**/encoding.h"/>
            <include name="**/grammar.h"/>
            <include name="**/start.h"/>
            <include name="**/end.h"/>
            <include name="**/content.h"/>
            <include name="**/attribute.h"/>
            <include name="**/list.h"/>
            <include name="**/name_list.h"/>
            <include name="**/visitor.h"/>
            <include name="**/caller*.h"/>
            <include name="**/name_caller*.h"/>
            <include name="**/optional.h"/>
            <exclude name="**/*_pch.h"/>
        </deploy>
        <copy todir="${dist.dir}/dll" flatten="true">
            <fileset dir="${run.dir}" includes="*.dll"/>
        </copy>
    </target>

    <!--
    ============================================================================
      package
    ============================================================================
    -->
    <target name="package" description="package the distribution">
        <zip destfile="${dist.dir}/xeumeuleu.zip" basedir=".." includes="build/**,src/**,data/**,*.txt" excludes="**/*.suo,**/*.ncb"/>
        <tar destfile="${dist.dir}/xeumeuleu.tar.bz2" basedir=".." includes="build/**,src/**,data/**,*.txt" excludes="**/*.suo,**/*.ncb" compression="bzip2"/>
    </target>

    <!--
    ============================================================================
      documentation
    ============================================================================
    -->
    <target name="site" depends="build,test" description="create web site">
        <forrest/>
    </target>

    <!-- requires scp : http://ant.apache.org/manual/OptionalTasks/scp.html -->
    <target name="deploy" depends="site" description="deploy web site">
        <if>
            <not>
                <isset property="deploy.scp.username"/>
            </not>
            <then>
                <input addproperty="deploy.scp.username" message="Enter username to enable scp to deploy:"/>
            </then>
        </if>
        <property name="deploy.scp.dest" value="${deploy.scp.username}@ssh.sourceforge.net:/home/groups/x/xe/xeumeuleu/htdocs"/>
        <if>
            <not>
                <isset property="deploy.scp.password"/>
            </not>
            <then>
                <input addproperty="deploy.scp.password" message="Enter remote password to enable scp to ${deploy.scp.dest}:"/>
            </then>
        </if>
        <scp todir="${deploy.scp.dest}" password="${deploy.scp.password}" trust="yes">
            <fileset dir="${doc.dir}/site"/>
        </scp>
    </target>

    <!--
    ============================================================================
      main
    ============================================================================
    -->
    <target name="test" depends="xeumeuleu_test" description="run all tests"/>

    <target name="build" depends="xeumeuleu" description="build all"/>

    <target name="configure" description="initialize local project structure with dependencies">
        <update name="boost"/>
        <update name="mockpp"/>
        <update name="xerces-c"/>
    </target>

    <target name="all" depends="configure,build,test,export,package,site" description="build, run tests, package distribution and create web site"/>

</project>
