<?xml version="1.0"?>
<project name="xeumeuleu" default="all">

    <property environment="env"/>
    <import file="${env.PONEY_HOME}/poney.xml"/>

    <!--
    ============================================================================
      tests
    ============================================================================
    -->

    <target name="xeumeuleu_test" description="build and run tests">
        <build-test name="xeumeuleu_xerces" input="xeumeuleu_test" depends="boost" libs="xerces-c_3">
            <includepath path="../include/xerces-c"/>
            <defineset define="XEUMEULEU_NO_DEPRECATED"/>
        </build-test>
    </target>

    <target name="xeuseuleu_test" description="build and run tests" if="has-xalan">
        <build-test name="xeuseuleu" depends="boost" libs="xerces-c_3,Xalan-C_1">
            <includepath path="../include/xerces-c"/>
        </build-test>
    </target>

    <!--
    ============================================================================
      applications
    ============================================================================
    -->
    <target name="xeumeuleu_bench" description="build benchmark application" if="has-xerces-3">
        <build-app name="xeumeuleu_bench" depends="boost" libs="xerces-c_3" subsystem="console">
            <includepath path="../include/xerces-c"/>
        </build-app>
    </target>

    <target name="xeumeuleu_clean" description="build cleaning application" if="has-xerces-3">
        <build-app name="xeumeuleu_clean" depends="boost" libs="xerces-c_3" subsystem="console">
            <includepath path="../include/xerces-c"/>
        </build-app>
    </target>

    <!--
    ============================================================================
      clean
    ============================================================================
    -->
    <target name="clean" description="clean intermediate build artifacts">
        <delete dir="${out.dir}"/>
    </target>

    <!--
    ============================================================================
      export
    ============================================================================
    -->
    <target name="export" description="export the distribution">
        <deploy>
            <module name="xeumeuleu">
                <include name="**/*.hpp"/>
                <include name="**/*.h"/>
            </module>
            <module name="xeuseuleu">
                <include name="**/*.hpp"/>
                <include name="**/*.h"/>
            </module>
        </deploy>
        <info version="svn rev ${svn.revision}" todir="${dist.dir}"/>
    </target>

    <!--
    ============================================================================
      package
    ============================================================================
    -->
    <target name="package" description="package the distribution">
        <mkdir dir="${dist.dir}"/>
        <zip destfile="${dist.dir}/${ant.project.name}.zip">
            <fileset dir="${root.dir}" includes="*.txt" excludes="CMakeLists.txt"/>
            <fileset dir="${libraries.dir}" excludes="**/turtle/**"/>
        </zip>
        <tar destfile="${dist.dir}/${ant.project.name}.tar.bz2" compression="bzip2">
            <fileset dir="${root.dir}" includes="*.txt" excludes="CMakeLists.txt"/>
            <fileset dir="${libraries.dir}" excludes="**/turtle/**"/>
        </tar>
    </target>

    <!--
    ============================================================================
      documentation
    ============================================================================
    -->
    <target name="documentation" description="create documentation">
        <cpd-report/>
        <tests-report/>
        <cppncss-report>
            <define name="XEUMEULEU_TRY"/>
            <define name="XEUMEULEU_CATCH"/>
            <define name="XERCES_CPP_NAMESPACE_BEGIN" value="namespace XERCES_CPP_NAMESPACE {"/>
            <define name="XERCES_CPP_NAMESPACE_END" value="}"/>
            <macro name="MOCK_METHOD"/>
            <macro name="MOCK_METHOD_TPL"/>
            <macro name="MOCK_METHOD_EXT"/>
            <macro name="MOCK_FUNCTOR" value="MOCK_FUNCTOR"/>
            <macro name="MOCK_CLASS" value="class mock"/>
            <macro name="MOCK_BASE_CLASS" value="class mock"/>
            <macro name="BOOST_CHECK_THROW"/>
            <macro name="BOOST_CHECK_NO_THROW"/>
            <macro name="BOOST_REQUIRE_THROW"/>
            <macro name="BOOST_REQUIRE_NO_THROW"/>
        </cppncss-report>
        <doxygen-report/>
    </target>

    <!--
    ============================================================================
      main
    ============================================================================
    -->
    <target name="test" depends="xeumeuleu_test,xeuseuleu_test" description="run all tests"/>

    <target name="build" depends="xeumeuleu_bench,xeumeuleu_clean" description="build all"/>

    <target name="configure" description="initialize local project structure with dependencies">
        <update name="boost"/>
        <update name="cpplibs"/>
    </target>

    <target name="all" depends="configure,build,test,export" description="build, run tests, package distribution and create web site"/>

</project>
