<?xml version="1.0"?>
<project name="xeumeuleu" default="all">

    <!--
    <import file="../../../../dev/projects/tools/poney/src/poney.xml"/>
    -->
    <import file="//install/masa/common/dev/common/poney/poney.xml"/>

    <!--
    ============================================================================
      libraries
    ============================================================================
    -->
    <target name="xeumeuleu" description="build library">
        <build-lib name="xeumeuleu"/>
    </target>

    <!--
    ============================================================================
      tests
    ============================================================================
    -->
    <target name="xeumeuleu_test" depends="xeumeuleu" description="build and run tests">
        <build-test name="xeumeuleu" libs="xeumeuleu,xerces-c_2"/>
    </target>

    <!--
    ============================================================================
      applications
    ============================================================================
    -->
    <target name="xeumeuleu_bench" depends="xeumeuleu" description="build benchmark application">
        <build-app name="xeumeuleu_bench" depends="boost" libs="xeumeuleu,xerces-c_2" subsystem="console"/>
    </target>

    <!--
    ============================================================================
      clean
    ============================================================================
    -->
    <target name="clean" description="clean intermediate build artifacts">
        <delete dir="${out.dir}"/>
    </target>

    <!--
    ============================================================================
      export
    ============================================================================
    -->
    <target name="export" depends="build,test" description="export the distribution">
        <deploy>
            <module name="xeumeuleu">
                <include name="xml.h"/>
                <include name="exception.h"/>
                <include name="xi*.h"/>
                <include name="xo*.h"/>
                <include name="encoding.h"/>
                <include name="grammar.h"/>
                <include name="start.h"/>
                <include name="end.h"/>
                <include name="content.h"/>
                <include name="cdata.h"/>
                <include name="attribute.h"/>
                <include name="list.h"/>
                <include name="name_list.h"/>
                <include name="attributes.h"/>
                <include name="visitor.h"/>
                <include name="caller*.h"/>
                <include name="name_caller*.h"/>
                <include name="optional.h"/>
            </module>
        </deploy>
    </target>

    <!--
    ============================================================================
      package
    ============================================================================
    -->
    <target name="package" description="package the distribution">
        <mkdir dir="${dist.dir}"/>
        <zip destfile="${dist.dir}/xeumeuleu.zip" basedir=".." includes="build/**,src/**,data/**,*.txt" excludes="**/*.suo,**/*.ncb,**/.*,**/*.user"/>
        <tar destfile="${dist.dir}/xeumeuleu.tar.bz2" basedir=".." includes="build/**,src/**,data/**,*.txt" excludes="**/*.suo,**/*.ncb,**/.*,**/*.user" compression="bzip2"/>
    </target>

    <target name="generate-vc80" description="create vc80 build files from vc71 files">
        <copy todir="vc80" overwrite="true">
            <fileset dir="vc71" includes="*.sln,*.vcproj"/>
            <filterchain>
                <tokenfilter>
                    <replacestring from="vc71" to="vc80"/>
                    <replacestring from="8.00" to="9.00"/>
                    <replacestring from="8,00" to="9.00"/>
                    <replacestring from="7.10" to="8.00"/>
                    <replacestring from="7,10" to="8.00"/>
                </tokenfilter>
            </filterchain>
        </copy>
    </target>

    <!--
    ============================================================================
      documentation
    ============================================================================
    -->
    <target name="documentation" description="create documentation">
        <cpd-report/>
        <cppncss-report>
            <define name="TRY"/>
            <define name="CATCH"/>
            <macro name="BOOST_CHECK_THROW"/>
            <macro name="BOOST_CHECK_NO_THROW"/>
        </cppncss-report>
        <doxygen-report/>
        <forrest/>
    </target>

    <target name="site" description="deploy web site">
        <zip destfile="${doc.dir}/site.zip">
            <fileset dir="${doc.dir}/site"/>
        </zip>
        <input addproperty="deploy.scp.username" message="Enter username to enable scp to deploy:"/>
        <property name="deploy.scp.dest" value="${deploy.scp.username}@shell.sourceforge.net:/home/groups/x/xe/xeumeuleu"/>
        <input addproperty="deploy.scp.password" message="Enter remote password to enable scp to ${deploy.scp.dest}:"/>
        <!-- requires scp : http://ant.apache.org/manual/OptionalTasks/scp.html -->
        <scp todir="${deploy.scp.dest}" password="${deploy.scp.password}" trust="yes" verbose="true" file="${doc.dir}/site.zip"/>
        <sshexec host="shell.sourceforge.net" username="${deploy.scp.username}" password="${deploy.scp.password}"
                 command="cd /home/groups/x/xe/xeumeuleu/htdocs;rm -r *;unzip ../site.zip" trust="yes"/>
    </target>

    <!--
    ============================================================================
      main
    ============================================================================
    -->
    <target name="test" depends="xeumeuleu_test" description="run all tests"/>

    <target name="build" depends="xeumeuleu" description="build all"/>

    <target name="configure" description="initialize local project structure with dependencies">
        <update name="boost"/>
        <update name="mockpp"/>
        <update name="xerces-c"/>
    </target>

    <target name="all" depends="configure,build,test,export,package,documentation" description="build, run tests, package distribution and create web site"/>

</project>
